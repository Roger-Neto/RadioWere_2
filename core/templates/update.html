<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editar Música</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5" id="app">
    <h1 class="mb-3">Editar Música</h1>
    <div class="card p-4">
      <form method="POST" action="{% url 'update' %}">
        {% csrf_token %}
        <div class="mb-3">
          <label for="songName" class="form-label">Nome da Música</label>
          <input type="text" id="songName" name="song" class="form-control" value="{{ song.name }}">
        </div>
        <div class="mb-3">
          <label for="songUrl" class="form-label">Link da Música</label>
          <input type="text" id="songUrl" name="url" class="form-control" value="{{ song.url }}">
        </div>
        <button type="submit" class="btn btn-primary">Salvar</button>
      </form>
    </div>
    
    <h3 class="mt-4">Playlist</h3>
    <div class="table-responsive" style="max-height: 200px; overflow-y: scroll;">
      <table class="table table-striped">
        <thead>
          <tr>
            <th style="width: 5%;">Select</th>
            <th style="width: 30%;">Nome</th>
            <th style="width: 50%;">URL</th>
            <th style="width: 15%;">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for song in playlist %}
          <tr>
            <td><input type="checkbox" class="song-checkbox" data-id="{{ song.id }}"></td>
            <td>{{ song.name }}</td>
            <td>{{ song.url }}</td>
            <td>
              <a href="{% url 'edit' song.id %}" class="btn btn-warning btn-sm">Editar</a>
              <button class="btn btn-danger btn-sm delete-btn" data-id="{{ song.id }}">Excluir</button>
              <button class="btn btn-success btn-sm play-btn" data-url="{{ song.url }}">
                <i class="bi bi-play-fill"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <button class="btn btn-danger mt-3" onclick="handleDeleteSelected()" id="deleteButton" disabled>Excluir Selecionados</button>
    <audio id="audioPlayer" style="display: none;"></audio>
  </div>

  <script>
    let selectedRows = [];

    document.addEventListener("DOMContentLoaded", function() {
      document.querySelectorAll(".delete-btn").forEach(button => {
        button.addEventListener("click", function() {
          const songId = this.getAttribute("data-id");
          handleDelete(songId);
        });
      });

      document.querySelectorAll(".play-btn").forEach(button => {
        button.addEventListener("click", function() {
          const songUrl = this.getAttribute("data-url");
          handlePlayPause(songUrl);
        });
      });

      document.querySelectorAll(".song-checkbox").forEach(checkbox => {
        checkbox.addEventListener("change", toggleRowSelection);
      });
    });

    function handleDelete(songId) {
      if (confirm("Tem certeza que deseja excluir esta música?")) {
        window.location.href = `/delete/${songId}`;
      }
    }

    function toggleRowSelection(event) {
      const checkbox = event.target;
      const songId = checkbox.getAttribute("data-id");
      if (checkbox.checked) {
        selectedRows.push(songId);
      } else {
        selectedRows = selectedRows.filter(id => id !== songId);
      }
      document.getElementById("deleteButton").disabled = selectedRows.length === 0;
    }

    function handleDeleteSelected() {
      if (selectedRows.length > 0 && confirm("Tem certeza que deseja excluir as músicas selecionadas?")) {
        window.location.href = `/delete_multiple?ids=${selectedRows.join(',')}`;
      }
    }

    function handlePlayPause(url) {
      const audioPlayer = document.getElementById('audioPlayer');
      if (audioPlayer.src === url && !audioPlayer.paused) {
        audioPlayer.pause();
      } else {
        audioPlayer.src = url;
        audioPlayer.play();
      }
    }
  </script>
</body>
</html>

